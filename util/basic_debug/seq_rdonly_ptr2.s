_start:
 seaq ptbl0(%rip),%rax
 seaq ptbl1(%rip), %rbx
 wrcsr $csr_page0, %rax
 wrcsr $csr_page1, %rbx

 seaq ptr_array(%rip), %rsi
 seaq ptr_array2(%rip), %rbx
 xorq %rax, %rax
 loop_init:
//pointer array initialisation
 seaq data_array(%rip), %rdx
 leaq (,%rax,8),%rcx
 addq %rdx,%rcx,%r8
 movq %r8,(%rsi,%rcx)
 addq %rsi,%rcx
 movq %rcx,(%rdi,%rcx)
 add $1, %rax
 cmp $256, %rax
 jne loop_init

 mov $64, %rdx
.p2align 5
loop2:
  movq $0, %r8
  movq 256, %rcx
  movl $0, %eax
.p2align 5
loop:
  movq (%rbx,%r8,8), %r10
  movq (%r10), %r11
  addl 4(%r11), %eax
  movl %eax, result(%rip)
  cloop loop
  sub $1, %rdx
  jeq loop2
ende:
  jmp ende


.data
data_array:
.long 0x000000000000ffff
.long 0x00000000000f0fff
.long 0x0000000000f00fff
.long 0x000000000f000fff
.long 0x00000000f0000fff
.long 0x0000000f00000fff
.long 0x000000f000000fff
.long 0x00000f0000000fff
.long 0x0000f00000000fff
.long 0x000f000000000fff
.long 0x00f0000000000fff
.long 0x0f00000000000fff
.long 0xf000000000000fff
.long 0x000000f00f000fff
.long 0x00000f000f000fff
.long 0x0000f0000f000fff

.long 0x000000000000eeee
.long 0x00000000000e0eee
.long 0x0000000000e00eee
.long 0x000000000e000eee
.long 0x00000000e0000eee
.long 0x0000000e00000eee
.long 0x000000e000000eee
.long 0x00000e0000000eee
.long 0x0000e00000000eee
.long 0x000e000000000eee
.long 0x00e0000000000eee
.long 0x0e00000000000eee
.long 0xe000000000000eee
.long 0x000000e00e000eee
.long 0x00000e000e000eee
.long 0x0000e0000e000eee

.long 0x000000000000dddd
.long 0x00000000000d0ddd
.long 0x0000000000d00ddd
.long 0x000000000d000ddd
.long 0x00000000d0000ddd
.long 0x0000000d00000ddd
.long 0x000000d000000ddd
.long 0x00000d0000000ddd
.long 0x0000d00000000ddd
.long 0x000d000000000ddd
.long 0x00d0000000000ddd
.long 0x0d00000000000ddd
.long 0xd000000000000ddd
.long 0x000000d00d000ddd
.long 0x00000d000d000ddd
.long 0x0000d0000d000ddd

.long 0x000000000000cccc
.long 0x00000000000c0ccc
.long 0x0000000000c00ccc
.long 0x000000000c000ccc
.long 0x00000000c0000ccc
.long 0x0000000c00000ccc
.long 0x000000c000000ccc
.long 0x00000c0000000ccc
.long 0x0000c00000000ccc
.long 0x000c000000000ccc
.long 0x00c0000000000ccc
.long 0x0c00000000000ccc
.long 0xc000000000000ccc
.long 0x000000c00c000ccc
.long 0x00000c000c000ccc
.long 0x0000c0000c000ccc

.long 0x000000000000bbbb
.long 0x00000000000b0bbb
.long 0x0000000000b00bbb
.long 0x000000000b000bbb
.long 0x00000000b0000bbb
.long 0x0000000b00000bbb
.long 0x000000b000000bbb
.long 0x00000b0000000bbb
.long 0x0000b00000000bbb
.long 0x000b000000000bbb
.long 0x00b0000000000bbb
.long 0x0b00000000000bbb
.long 0xb000000000000bbb
.long 0x000000b00b000bbb
.long 0x00000b000b000bbb
.long 0x0000b0000b000bbb

.long 0x000000000000aaaa
.long 0x00000000000a0aaa
.long 0x0000000000a00aaa
.long 0x000000000a000aaa
.long 0x00000000a0000aaa
.long 0x0000000a00000aaa
.long 0x000000a000000aaa
.long 0x00000a0000000aaa
.long 0x0000a00000000aaa
.long 0x000a000000000aaa
.long 0x00a0000000000aaa
.long 0x0a00000000000aaa
.long 0xa000000000000aaa
.long 0x000000a00a000aaa
.long 0x00000a000a000aaa
.long 0x0000a0000a000aaa

.long 0x0000000000009999
.long 0x0000000000090999
.long 0x0000000000900999
.long 0x0000000009000999
.long 0x0000000090000999
.long 0x0000000900000999
.long 0x0000009000000999
.long 0x0000090000000999
.long 0x0000900000000999
.long 0x0009000000000999
.long 0x0090000000000999
.long 0x0900000000000999
.long 0x9000000000000999
.long 0x0000009009000999
.long 0x0000090009000999
.long 0x0000900009000999

.long 0x0000000000008888
.long 0x0000000000080888
.long 0x0000000000800888
.long 0x0000000008000888
.long 0x0000000080000888
.long 0x0000000800000888
.long 0x0000008000000888
.long 0x0000080000000888
.long 0x0000800000000888
.long 0x0008000000000888
.long 0x0080000000000888
.long 0x0800000000000888
.long 0x8000000000000888
.long 0x0000008008000888
.long 0x0000080008000888
.long 0x0000800008000888

.long 0x0000000000007777
.long 0x0000000000070777
.long 0x0000000000700777
.long 0x0000000007000777
.long 0x0000000070000777
.long 0x0000000700000777
.long 0x0000007000000777
.long 0x0000070000000777
.long 0x0000700000000777
.long 0x0007000000000777
.long 0x0070000000000777
.long 0x0700000000000777
.long 0x7000000000000777
.long 0x0000007007000777
.long 0x0000070007000777
.long 0x0000700007000777

.long 0x0000000000006666
.long 0x0000000000060666
.long 0x0000000000600666
.long 0x0000000006000666
.long 0x0000000060000666
.long 0x0000000600000666
.long 0x0000006000000666
.long 0x0000060000000666
.long 0x0000600000000666
.long 0x0006000000000666
.long 0x0060000000000666
.long 0x0600000000000666
.long 0x6000000000000666
.long 0x0000006006000666
.long 0x0000060006000666
.long 0x0000600006000666

.long 0x0000000000005555
.long 0x0000000000050555
.long 0x0000000000500555
.long 0x0000000005000555
.long 0x0000000050000555
.long 0x0000000500000555
.long 0x0000005000000555
.long 0x0000050000000555
.long 0x0000500000000555
.long 0x0005000000000555
.long 0x0050000000000555
.long 0x0500000000000555
.long 0x5000000000000555
.long 0x0000005005000555
.long 0x0000050005000555
.long 0x0000500005000555

.long 0x0000000000004444
.long 0x0000000000040444
.long 0x0000000000400444
.long 0x0000000004000444
.long 0x0000000040000444
.long 0x0000000400000444
.long 0x0000004000000444
.long 0x0000040000000444
.long 0x0000400000000444
.long 0x0004000000000444
.long 0x0040000000000444
.long 0x0400000000000444
.long 0x4000000000000444
.long 0x0000004004000444
.long 0x0000040004000444
.long 0x0000400004000444

.long 0x000000000000ffff
.long 0x00000000000f0fff
.long 0x0000000000f00fff
.long 0x000000000f000fff
.long 0x00000000f0000fff
.long 0x0000000f00000fff
.long 0x000000f000000fff
.long 0x00000f0000000fff
.long 0x0000f00000000fff
.long 0x000f000000000fff
.long 0x00f0000000000fff
.long 0x0f00000000000fff
.long 0xf000000000000fff
.long 0x000000f00f000fff
.long 0x00000f000f000fff
.long 0x0000f0000f000fff

.long 0x000000000000eeee
.long 0x00000000000e0eee
.long 0x0000000000e00eee
.long 0x000000000e000eee
.long 0x00000000e0000eee
.long 0x0000000e00000eee
.long 0x000000e000000eee
.long 0x00000e0000000eee
.long 0x0000e00000000eee
.long 0x000e000000000eee
.long 0x00e0000000000eee
.long 0x0e00000000000eee
.long 0xe000000000000eee
.long 0x000000e00e000eee
.long 0x00000e000e000eee
.long 0x0000e0000e000eee

.long 0x000000000000ffff
.long 0x00000000000f0fff
.long 0x0000000000f00fff
.long 0x000000000f000fff
.long 0x00000000f0000fff
.long 0x0000000f00000fff
.long 0x000000f000000fff
.long 0x00000f0000000fff
.long 0x0000f00000000fff
.long 0x000f000000000fff
.long 0x00f0000000000fff
.long 0x0f00000000000fff
.long 0xf000000000000fff
.long 0x000000f00f000fff
.long 0x00000f000f000fff
.long 0x0000f0000f000fff

.long 0x000000000000ffff
.long 0x00000000000f0fff
.long 0x0000000000f00fff
.long 0x000000000f000fff
.long 0x00000000f0000fff
.long 0x0000000f00000fff
.long 0x000000f000000fff
.long 0x00000f0000000fff
.long 0x0000f00000000fff
.long 0x000f000000000fff
.long 0x00f0000000000fff
.long 0x0f00000000000fff
.long 0xf000000000000fff
.long 0x000000f00f000fff
.long 0x00000f000f000fff
.long 0x0000f0000f000fff
.comm ptr_array,2048
.comm ptr_array2,2048
.comm result,4
